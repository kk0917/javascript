<!DOCTYPE html>
<html xml:lang="ja" lang="ja">
<head>
<meta charset="utf-8">
<meta name="robots" content="noindex,nofollow"/>
<meta name="viewport" content="width=device-width">
<title>JavaScript TechnicalNote － SAMPLE</title>
<link rel="stylesheet" href="../../common/css/common.css">
<link rel="stylesheet" href="../../common/css/rwdlayout.css">
<style>
p {
  padding-bottom: 2em;
  visibility: hidden;
}
.textOpen {
  text-decoration: none;
  margin-left: 10px;
  color: #ff0000;
  font-weight: bold;
}
.textClose {
  text-decoration: none;
  margin-left: 10px;
  color: #666;
  font-weight: bold;
}
</style>
</head>

<body>

<header class="baseHeader">
<div>
<h1>jQuery TECHNIQUE</h1>
<a href="../../chapterList.html">&gt;&nbsp;CHAPTER LIST</a>
</div>
</header>

<h2 id="title">テキストが長い場合は「続きを見る」リンクを表示する</h2>

<div id="wrapper">

<p>窓の外の、まるで花火でいっぱいのような、あまの川のまん中に、黒い大きな建物が四棟ばかり立って、その一つの平屋根の上に、眼もさめるような、青宝玉と黄玉の大きな二つのすきとおった球が、輪になってしずかにくるくるとまわっていました。黄いろのがだんだん向うへまわって行って、青い小さいのがこっちへ進んで来、間もなく二つのはじは、重なり合って、きれいな緑いろの両面凸レンズのかたちをつくり、それもだんだん、まん中がふくらみ出して、とうとう青いのは、すっかりトパースの正面に来ましたので、緑の中心と黄いろな明るい環とができました。それがまただんだん横へ外れて、前のレンズの形を逆に繰り返し、とうとうすっとはなれて、サファイアは向うへめぐり、黄いろのはこっちへ進み、また丁度さっきのような風になりました。銀河の、かたちもなく音もない水にかこまれて、ほんとうにその黒い測候所が、睡っているように、しずかによこたわったのです。</p>

<p>「あれは、水の速さをはかる器械です。水も……。」鳥捕りが云いかけたとき、「切符を拝見いたします。」三人の席の横に、赤い帽子をかぶったせいの高い車掌が、いつかまっすぐに立っていて云いました。鳥捕りは、だまってかくしから、小さな紙きれを出しました。車掌はちょっと見て、すぐ眼をそらして、（あなた方のは？）というように、指をうごかしながら、手をジョバンニたちの方へ出しました。</p>

<p>「さあ、」ジョバンニは困って、もじもじしていましたら、カムパネルラは、わけもないという風で、小さな鼠いろの切符を出しました。ジョバンニは、すっかりあわててしまって、もしか上着のポケットにでも、入っていたかとおもいながら、手を入れて見ましたら、何か大きな畳んだ紙きれにあたりました。こんなもの入っていたろうかと思って、急いで出してみましたら、それは四つに折ったはがきぐらいの大きさの緑いろの紙でした。車掌が手を出しているもんですから何でも構わない、やっちまえと思って渡しましたら、車掌はまっすぐに立ち直って叮寧にそれを開いて見ていました。そして読みながら上着のぼたんやなんかしきりに直したりしていましたし燈台看守も下からそれを熱心にのぞいていましたから、ジョバンニはたしかにあれは証明書か何かだったと考えて少し胸が熱くなるような気がしました。</p>

<p>「これは三次空間の方からお持ちになったのですか。」車掌がたずねました。「何だかわかりません。」もう大丈夫だと安心しながらジョバンニはそっちを見あげてくつくつ笑いました。「よろしゅうございます。南十字へ着きますのは、次の第三時ころになります。」車掌は紙をジョバンニに渡して向うへ行きました。</p>

<p>カムパネルラは、その紙切れが何だったか待ち兼ねたというように急いでのぞきこみました。ジョバンニも全く早く見たかったのです。ところがそれはいちめん黒い唐草のような模様の中に、おかしな十ばかりの字を印刷したものでだまって見ていると何だかその中へ吸い込まれてしまうような気がするのでした。すると鳥捕りが横からちらっとそれを見てあわてたように云いました。「おや、こいつは大したもんですぜ。こいつはもう、ほんとうの天上へさえ行ける切符だ。天上どこじゃない、どこでも勝手にあるける通行券です。こいつをお持ちになれぁ、なるほど、こんな不完全な幻想第四次の銀河鉄道なんか、どこまででも行ける筈でさあ、あなた方大したもんですね。」「何だかわかりません。」ジョバンニが赤くなって答えながらそれを又畳んでかくしに入れました。そしてきまりが悪いのでカムパネルラと二人、また窓の外をながめていましたが、その鳥捕りの時々大したもんだというようにちらちらこっちを見ているのがぼんやりわかりました。「もうじき鷲の停車場だよ。」カムパネルラが向う岸の、三つならんだ小さな青じろい三角標と地図とを見較べて云いました。</p>

</div><!-- /#wrapper -->

<footer class="baseFooter">
<small>Copyright &copy; kkkk. All Rights Reserved.</small>
</footer>

<script src="../jquery-1.12.4.min.js"></script>
<script src="../../common/js/common.js"></script>
<script>
var pElemAll     = document.querySelectorAll("p");
var cutStrLength = 100;
var openText     = "... 続きを見る";
var closeText    = "[×] 閉じる";

pElemAll.forEach(function(element, index, array) {
  var textAll   = element.textContent;
  var textLength = textAll.length
  var textTrim   = textAll.substr(0, cutStrLength);
  
  function textTrimming() {
    // カットした文字列に「続きを見る」ボタンを付けた要素をp要素の子要素として上書き
    element.innerHTML =
      textTrim
      + "<a href='javascript:void(0);' class='textOpen'>"
      + openText
      + "</a>";
    // 非表示にしていたp要素を表示
    element.style.visibility = "visible";

    // 「続きを見る」ボタンクリックで全文表示 + 閉じるボタン付与 のイベント登録
    var textOpenBtn = element.querySelector(".textOpen");
    textOpenBtn.addEventListener("click", function() {
      element.innerHTML =
        textAll
        + "<a href='javascript:void(0);' class='textClose'>"
        + closeText
        + "</a>";
      
      // 閉じるボタンクリック時の文字表示制御 + 「続きを見る」ボタン付与 のイベント登録
      var textCloseBtn = element.querySelector(".textClose");
      textCloseBtn.addEventListener("click", function() {
        textTrimming();
      }, false);
    }, false);
  }

  // 制限文字数よりp要素の文字数がオーバーしている場合はトリミング処理の実行
  if (cutStrLength < textLength) {
    textTrimming();
  // p要素の文字数が制限文字数内であれば、そのまま表示
  } else {
    element.style.visibility = "visible";
  }
});
</script>
</body>
</html>
